<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/nav.css">
    <link rel="stylesheet" href="css/expandir.css">
    <link rel="stylesheet" href="css/footer.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/menuH.js"></script>
    <script src="js/usuarios.js"></script>
    <title>Vaga Fácil</title>
</head>

<body>
    <!-- Começo do Header -->
    <header>
        <nav class="nav">

            <a href=""><img class="logo" src="img/logo.png" alt="Home"></a>

            <img class="menuH" onclick="menuH()" src="img/menuH.png" alt="Menu Hamburguer">

            <div id="listaMenuH">
                <img onclick="seta()" src="img/seta.png" alt="">
                <ul class="itens-menuH">
                    <!-- <li><a href="dashboard.html">Dashboard</a></li> -->
                    <li><a href="acompanhar.html">Acompanhar</a></li>
                    <li><a href="expandir.html">Expandir</a></li>
                    <li><a href="perfil.html">Perfil</a></li>
                    <li><a href="usuarios.html">Lista de usuários</a></li>
                    <li><a href="adicionarUsuario.html">Adicionar usuário</a></li>
                    <button class="btn-site" onclick="sair()">Site Institucional</button>
                </ul>
            </div>
        </nav>
        <div id="alertSair">
            <div class="caixa">
                <h1>Deseja voltar para o Site Institucional?</h1>
                <button onclick="sim()">Sim</button>
                <button onclick="nao()">Não</button>
            </div>
        </div>
    </header>
    <!-- Fim do Header -->

    <div class="dashboard">
        <div class="containerBairro" id="divBairro">
            <div class="bairroFiltros">
                <h2><a href="./Acompanhar.html"><img src="img/seta_voltar.png"
                            alt="Retornar para página de acompanhamento"></a>Filtros</h2>
                <div>
                    Procurar um bairro:
                </div>
                <input id="inpPesquisaBairro" onkeyup="filtrarNomeERegiao()">
                <div>
                    Região: <label class="switch">
                        <input type="checkbox" onclick="changeDisabled('selRegiaoBairro'); filtrarNomeERegiao();">
                        <span class="slider"></span>
                    </label>
                </div>
                <select id="selRegiaoBairro" onchange="filtrarNomeERegiao()" disabled="true">
                    <option value="-">- Selecione uma região -</option>
                    <option value="Norte">Norte</option>
                    <option value="Sul">Sul</option>
                    <option value="Leste">Leste</option>
                    <option value="Oeste">Oeste</option>
                    <option value="Centro">Centro</option>
                </select>

                <div>
                    Faixa de Renda: <label class="switch">
                        <input type="checkbox" onclick="changeDisabled('selRendaBairro'); filtrarRenda();">
                        <span class="slider"></span>
                    </label>
                </div>
                <select id="selRendaBairro" onchange="filtrarRenda()" disabled="true">
                    <option value="-">- Selecione uma faixa -</option>
                    <option value="1">Baixa</option>
                    <option value="2">Média</option>
                    <option value="3">Alta</option>
                </select>

                <div>
                    Faixa Etária: <label class="switch">
                        <input type="checkbox" onclick="changeDisabled('selIdadeBairro'); filtrarIdade();">
                        <span class="slider"></span>
                    </label>
                </div>
                <select id="selIdadeBairro" onchange="filtrarIdade()" disabled="true">
                    <option value="-">- Selecione uma faixa -</option>
                    <option value="1">Adolescente</option>
                    <option value="2">Jovem adulto</option>
                    <option value="3">Adulto</option>
                    <option value="4">Idoso</option>
                </select>
            </div>

            <div class="bairroLista" id="divBairroLista">

            </div>
        </div>

        <div class="containerRua" id="divRua">
            <div class="ruaFiltros">
                <h2><img src="img/seta_voltar.png" alt="Retornar para a lista de bairros"
                        onclick="mostrarBairros()">Filtros</h2>
                <div>
                    Procurar uma rua:
                </div>
                <input id="inpPesquisaRua" onkeyup="filtrarNomeRua()">
            </div>
            <div class="ruaLista" id="divRuaLista">
            </div>
        </div>

        <div class="containerDados" id="divDados">
            <div class="containerDadosFiltros">
                <!-- <div class="titulo"> -->
                    <h2><img src="img/seta_voltar.png" alt="Retornar para a lista de ruas"
                            onclick="mostrarRuas()"><span id="spanEnderecoSel"></span><button onclick="cadastrarFilial()" class="btnCadastrar">Cadastrar Filial</button></h2>
                <!-- </div> -->
                <!-- <div class="endereco">

                </div> -->
                
            </div>
            <div class="containerGraficos">
                <div class="cardGauge">
                    <canvas id="canvGauge1" class="canvasGauge"></canvas>
                    <canvas id="canvGauge2" class="canvasGauge"></canvas>
                </div>
                <div class="kpi">
                    <div class="kpiCritico">
                        Critico
                    </div>
                    <div class="kpiAlerta">
                        Alerta
                    </div>
                    <div class="kpiIdeal">
                        Bom
                    </div>
                    <div class="kpiPerfeito">
                        Ideal
                    </div>
                </div>
                <div class="cardGrafico">
                        <div class="card">
                            <div>Tipo
                            </div>
                            <select id="selTipo" onchange="mudarTipoGrafico()">
                                <option value="tempoReal">Tempo Real</option>
                                <option value="anual">Histórico Anual</option>
                                <option value="semanal">Histórico Semanal</option>
                                <option value="diario">Histórico Diário</option>
                            </select>
                        </div>
                        
                    <canvas id="canvLine"></canvas>
                    <cavas id="canvMap"></cavas>
                </div>
            </div>
        </div>
    </div>


    <!--Início Footer-->
    <footer>
        <div class="rodape">
            <div class="container">
                <div class="cardFooter">
                    <img src="img/logo.png" id="logoFooter">
                </div>
                <div class="cardFooterCentral">
                    <ul>
                        <!-- <li>
                            <a href="dashboard.html">Dashboard</a>
                        </li> -->
                        <li>
                            <a href="Acompanhar.html">Acompanhar</a>
                        </li>
                        <li>
                            <a href="expandir.html">Expandir</a>
                        </li>
                        <li>
                            <a href="perfil.html">Perfil</a>
                        </li>
                        <li>
                            <a href="usuarios.html">Lista de usuários</a>
                        </li>
                        <li>
                            <a href="adicionarUsuario.html">Adicionar usuário</a>
                        </li>
                        <li>
                            <a href="../index.html">Site Institucional</a>
                        </li>
                    </ul>
                </div>
                <div class="cardFooter">
                    <a href=""><img src="../img/instagram.png" alt="Link para nossa página no instagram"></a>
                    <a href=""><img src="../img/facebook.png" alt="Link para nossa página no FaceBook"></a>
                    <a href=""><img src="../img/twitter.png" alt="Link para nossa página no Twitter"></a>
                </div>
            </div>
        </div>
    </footer>
    <!--Fim do Footer-->
</body>

</html>

<script>
    // Início de tela de filtros de bairro
    var cards = [];

    fetch('/expandir/listarBairro').then(function (response) {
        if (response.ok) {
            response.json().then(function (resposta) {
                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                cards = resposta;
                for (var i = 0; i < resposta.length; i++) {
                    divBairroLista.innerHTML += `<div class="bairroCard" id="card${cards[i].idBairro}" onclick="mostrarRuas(${cards[i].idBairro})">
                                <img src="img/bairros/${cards[i].idBairro}.png">
                                <h3>${cards[i].bairro}</h3>
                                <p>Ocupação Média: ${(cards[i].ocupacao * 100).toFixed(1)}%</p>
                            </div>`;
                    cards[i].card = 'card' + cards[i].idBairro;
                }
            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    }).catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ lista: ${error.message}`);
    });

    function filtrarNomeERegiao() {
        var nome = inpPesquisaBairro.value.toLowerCase();
        var regiao = selRegiaoBairro.value;
        if (selRegiaoBairro.disabled) {
            regiao = '-';
        }
        for (var i = 0; i < cards.length; i++) {
            if (cards[i].bairro.toLowerCase().indexOf(nome) > -1 && (cards[i].zona == regiao || regiao == '-')) {
                document.getElementById(cards[i].card).style.display = 'flex';
            } else {
                document.getElementById(cards[i].card).style.display = 'none';
            }
        }
    }

    function filtrarRenda() {
        var renda = selRendaBairro.value;
        if (selRendaBairro.disabled) {
            renda = '-';
        }

        if (renda == '-') {
            cards.sort((a, b) => b.ocupacao - a.ocupacao);
        } else if (renda == '1') {
            cards.sort((a, b) => b.baixa - a.baixa);
        } else if (renda == '2') {
            cards.sort((a, b) => b.media - a.media);
        } else {
            cards.sort((a, b) => b.alta - a.alta);
        }

        for (var i = 1; i <= cards.length; i++) {
            document.getElementById(cards[i - 1].card).style.order = i;
        }
    }

    function filtrarIdade() {
        var idade = selIdadeBairro.value;

        if (selIdadeBairro.disabled) {
            idade = '-';
        }

        if (idade == '-') {
            cards.sort((a, b) => b.ocupacao - a.ocupacao);
        } else if (idade == '1') {
            cards.sort((a, b) => b.adolescente - a.adolescente);
        } else if (idade == '2') {
            cards.sort((a, b) => b.jovemAdulto - a.jovemAdulto);
        } else if (idade == '3') {
            cards.sort((a, b) => b.adulto - a.adulto);
        } else if (idade == '4') {
            cards.sort((a, b) => b.idoso - a.idoso);
        }

        for (var i = 1; i <= cards.length; i++) {
            document.getElementById(cards[i - 1].card).style.order = i;
        }
    }

    function mostrarBairros() {
        divBairro.style.display = 'flex';
        divRua.style.display = 'none';
    }
    // Fim de tela de filtro de bairros

    // Início de tela de filtro de ruas
    var ruas = [];

    function mostrarRuas(idBairro) {
        divRua.style.display = 'flex';
        divBairro.style.display = 'none';
        divDados.style.display = 'none';
        selTipo.value = 'tempoReal';
        fetch(`/expandir/listarRuas/${idBairro}`).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    divRuaLista.innerHTML = '';
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    ruas = resposta;
                    for (var i = 0; i < resposta.length; i++) {
                        divRuaLista.innerHTML += `<div onclick="mostrarDados(${ruas[i].idEndereco}, '${ruas[i].logradouro}')" class="ruaCard" id="rua${ruas[i].idEndereco}">
                                <h3>${ruas[i].logradouro}</h3>
                                <p>Ocupação Média: ${(ruas[i].ocupacao * 100).toFixed(1)}%</p></div>`
                    }
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ lista: ${error.message}`);
        });
    }

    function filtrarNomeRua() {
        var nome = inpPesquisaRua.value.toLowerCase();
        for (var i = 0; i < ruas.length; i++) {
            if (ruas[i].innerHTML.toLowerCase().indexOf(nome) > -1) {
                ruas[i].style.display = 'flex';
            } else {
                ruas[i].style.display = 'none';
            }
        }
    }

    var dadosHistorico = {};
    var dadosTempoReal = [];

    function mostrarDados(idRua, logradouro) {
        divDados.style.display = 'flex';
        divRua.style.display = 'none';
        fetch('/expandir/historicoMensal/' + idRua).then((response) => {
            if (response.ok) {
                response.json().then(function (resposta) {
                    var labels = [];
                    // Criando estrutura para plotar gráfico - dados
                    var dados = {
                        labels: labels,
                        datasets: [{
                            label: 'Mês',
                            data: [],
                            fill: false,
                            borderColor: '#F49C24',
                            tension: 0.1
                        }]
                    };
                    // Inserindo valores recebidos em estrutura para plotar o gráfico
                    for (i = 0; i < resposta.length; i++) {
                        var registro = resposta[i];
                        labels.push(registro.mes);
                        dados.datasets[0].data.push(registro.valor);
                    }
                    dadosHistorico.mensal = dados;
                });
            }
        }).catch((erro) => {
            dadosHistorico.mensal = '';
        });

        fetch('/expandir/historicoSemanal/' + idRua).then((response) => {
            if (response.ok) {
                response.json().then(function (resposta) {
                    
                    var labels = [`Domingo`, `Segunda`, `Terça`, `Quarta`, `Quinta`, `Sexta`,`Sabado`];
                    // Criando estrutura para plotar gráfico - dados
                    var dados = {
                        labels: labels,
                        datasets: [{
                            label: 'Dia',
                            data: [],
                            fill: false,
                            borderColor: '#F49C24',
                            tension: 0.1
                        }]
                    };
                    // Inserindo valores recebidos em estrutura para plotar o gráfico
                    for (i = 0; i < resposta.length; i++) {
                        var registro = resposta[i];
                        // labels.push(registro.dia);
                        dados.datasets[0].data.push(registro.valor);
                    }
                    dadosHistorico.semanal = dados;
                });
            }
        }).catch((erro) => {
            dadosHistorico.semanal = '';
        });

        fetch('/expandir/historicoDiario/' + idRua).then((response) => {
            if (response.ok) {
                response.json().then(function (resposta) {
                    
                    var labels = [];
                    // Criando estrutura para plotar gráfico - dados
                    var dados = {
                        labels: labels,
                        datasets: [{
                            label: 'Hora',
                            data: [],
                            fill: false,
                            borderColor: '#F49C24',
                            tension: 0.1
                        }]
                    };
                    // Inserindo valores recebidos em estrutura para plotar o gráfico
                    for (i = 0; i < resposta.length; i++) {
                        var registro = resposta[i];
                        labels.push(registro.hora);
                        dados.datasets[0].data.push(registro.valor);
                    }
                    dadosHistorico.diario = dados;
                });
            }
        }).catch((erro) => {
            dadosHistorico.diario = '';
        });
        spanEnderecoSel.innerHTML = logradouro;
        plotarTempoMedio(idRua);
        plotarOcupacao(idRua);
        obterDadosGrafico(idRua);
        idAtual = idRua;
    }
    // Fim de tela de filtro de ruas

    function changeDisabled(elemento) {
        var disabled = document.getElementById(elemento).disabled
        document.getElementById(elemento).disabled = !disabled;
    }

    // Início de tela de dados

    var idAtual = -1;

    const chartGauge1 = document.getElementById('canvGauge1');
    var chartTempoMedio = new Chart(chartGauge1, {
        type: 'doughnut',
        data: {
            datasets: [{
                data: [0, 120],
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Tempo médio de permanência',
                    color: '#F49C24',
                    font: {
                        size: 20
                    }
                },
                subtitle: {
                    display: true,
                    text: '- mins',
                    color: '#F49C24',
                    padding: 0,
                    font: {
                        size: 16
                    }
                },
            },
            backgroundColor: ['#F49C24', '#0C243C'],
            borderColor: '#FCF4EC',
            circumference: 180,
            rotation: -90,
            cutout: '70%'
        }
    });

    function plotarTempoMedio(idRua) {
        fetch('/expandir/tempo-medio/' + idRua, { cache: 'no-store' }).then((response) => {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    var tempoMedio = Math.round(resposta.tempoMedio);
                    console.log(tempoMedio);
                    var cor = '';
                    if (tempoMedio <= 15) {
                        cor = 'green';
                    } else if (tempoMedio <= 30) {
                        cor = 'limegreen';
                    } else if (tempoMedio <= 60) {
                        cor = 'yellow';
                    } else {
                        cor = 'red';
                    }
                    chartTempoMedio.data.datasets[0].data = [tempoMedio, 120 - tempoMedio];
                    chartTempoMedio.options.plugins.title.color = cor;
                    chartTempoMedio.options.plugins.subtitle.color = cor;
                    chartTempoMedio.options.plugins.subtitle.text = tempoMedio + ' min';
                    chartTempoMedio.options.backgroundColor = [cor, '#0C243C'];
                    chartTempoMedio.update();
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        }).catch((erro) => {

        });

    }

    const chartGauge2 = document.getElementById('canvGauge2');
    var chartOcupacao = new Chart(chartGauge2, {
        type: 'doughnut',
        data: {
            datasets: [{
                data: [0, 100],
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Ocupação média',
                    color: '#FCF4EC',
                    font: {
                        size: 20
                    }
                },
                subtitle: {
                    display: true,
                    text: '0%',
                    color: '#FCF4EC',
                    padding: 0,
                    font: {
                        size: 16
                    }
                },
            },
            backgroundColor: ['#FCF4EC', '#0C243C'],
            borderColor: '#FCF4EC',
            circumference: 180,
            rotation: -90,
            cutout: '70%'
        }
    });

    function plotarOcupacao(idRua) {
        fetch('/expandir/ocupacao/' + idRua, { cache: 'no-store' }).then((response) => {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    var ocupacao = Math.floor(100 * resposta[0].ocupacao);
                    var cor = '';
                    if (ocupacao < 35) {
                        cor = 'red';
                    } else if (ocupacao < 60) {
                        cor = 'yellow';
                    } else if (ocupacao < 90) {
                        cor = 'limegreen';
                    } else {
                        cor = 'green';
                    }
                    chartOcupacao.data.datasets[0].data = [ocupacao, 100 - ocupacao];
                    chartOcupacao.options.plugins.title.color = cor;
                    chartOcupacao.options.plugins.subtitle.color = cor;
                    chartOcupacao.options.plugins.subtitle.text = ocupacao + '%';
                    chartOcupacao.options.backgroundColor = [cor, '#0C243C'];
                    chartOcupacao.update();
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        }).catch((erro) => {

        });

    }


    var contextoChave = document.getElementById('canvLine').getContext('2d');
    contextoChave.canvas.width = 220;
    contextoChave.canvas.height = 100;
    // var cores = ['#F49C24', '#F49C24', '#F49C24', '#F49C24', '#F49C24', '#F49C24', '#F49C24', '#F49C24', '#F49C24', '#F49C24'];
    var chartLinha = new Chart(
        contextoChave,
        {
            type: 'line',
            data: {
                datasets: [{
                    label: 'Chave',
                    type: 'line',
                    borderColor: '#F49C24',
                    backgroundColor: '#F49C24',
                }],
            },
            options: {
                plugins: {
                    title: {
                        display: true,
                        text: 'Ocupação Recente',
                        color: '#F49C24',
                        font: {
                            size: 20
                        }
                    },
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            color: '#F49C24',
                        }
                    },
                    x: {
                        ticks: {
                            color: '#F49C24',
                        },
                    },
                    xAxes: [{
                        distribution: 'series',
                        ticks: {
                            beginAtZero: true,
                        },
                    }],
                    yAxes: [{
                        ticks: {
                            display: true,
                            beginAtZero: true,
                        }
                    }]
                }
            }
        }
    );

    function mudarTipoGrafico() {
        var tipo = selTipo.value;
        if (tipo == 'tempoReal') {
            obterDadosGrafico(idAtual);
        } else if (tipo == "diario") {

            chartLinha.data = dadosHistorico.diario;
            chartLinha.options.plugins.title.text = 'Historico Diario';
            chartLinha.update();
        } else if (tipo == "semanal") {

            chartLinha.data = dadosHistorico.semanal;
            chartLinha.options.plugins.title.text = 'Historico Semanal';
            chartLinha.update();
        } else {

            chartLinha.data = dadosHistorico.mensal;
            chartLinha.options.plugins.title.text = 'Historico Anual';
            chartLinha.update();
        }
    }

    let proximaAtualizacao;

    function obterDadosGrafico(idRua) {

        if (proximaAtualizacao != undefined) {
            clearTimeout(proximaAtualizacao);
        }

        fetch(`/expandir/ultimas/${idRua}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    plotarGrafico(resposta, idRua);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
        .catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }

    // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
    // Configura o gráfico (cores, tipo, etc), materializa-o na página e, 
    // A função *plotarGrafico* também invoca a função *atualizarGrafico*
    function plotarGrafico(resposta, idRua) {

        console.log('iniciando plotagem do gráfico...');

        // Criando estrutura para plotar gráfico - labels
        let labels = [];

        // Criando estrutura para plotar gráfico - dados
        let dados = {
            labels: labels,
            datasets: [{
                label: 'Hora',
                data: [],
                fill: false,
                borderColor: '#F49C24',
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.hora);
            dados.datasets[0].data.push(registro.valor);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        // Criando estrutura para plotar gráfico - config
        // const config = {
        //     type: 'line',
        //     data: dados,
        // };

        // // Adicionando gráfico criado em div na tela
        // let myChart = new Chart(
        //     document.getElementById(`canvLine`),
        //     config
        // );
        chartLinha.data = dados;
        chartLinha.options.plugins.title.text = 'Ocupação Recente';
        chartLinha.update();

        setTimeout(() => atualizarGrafico(idRua, dados), 2000);
    }

    // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
    // buscando a última medida inserida em tabela contendo as capturas, 

    //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
    //     Para ajustar o "select", ajuste o comando sql em src/models
    function atualizarGrafico(idRua, dados) {

        fetch(`/expandir/tempo-real/${idRua}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {

                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(dados);


                    if (novoRegistro[0].hora == dados.labels[dados.labels.length - 1]) {
                        console.log("---------------------------------------------------------------")
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.")
                        // avisoCaptura.innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará."
                        console.log("Horário do novo dado capturado:")
                        console.log(novoRegistro[0].hora)
                        console.log("Horário do último dado capturado:")
                        console.log(dados.labels[dados.labels.length - 1])
                        console.log("---------------------------------------------------------------")
                    } else {
                        // tirando e colocando valores no gráfico
                        dados.labels.shift(); // apagar o primeiro
                        dados.labels.push(novoRegistro[0].hora); // incluir um novo momento

                        dados.datasets[0].data.shift();  // apagar o primeiro de umidade
                        dados.datasets[0].data.push(novoRegistro[0].valor); // incluir uma nova medida de umidade

                        chartLinha.update();
                    }

                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(() => atualizarGrafico(idRua, dados), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                proximaAtualizacao = setTimeout(() => atualizarGrafico(idRua, dados), 2000);
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }


    function cadastrarFilial() {
        var rua = ruas.find((x) => x.idEndereco == idAtual);
        sessionStorage.LOGRADOURO = rua.logradouro;
        sessionStorage.CEP = rua.cep;
        sessionStorage.BAIRRO = rua.nome;
        window.location = './adicionarFilial.html';
    }

    // Fim de tela de dados
</script>